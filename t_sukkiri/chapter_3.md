# スッキリわかる SQL 入門 第 2 版

## 第 Ⅰ 部　 SQL を始めよう

### 第 3 章　操作する行の絞り込み

#### where 句による絞り込み

- 処理対象行の絞り込みに用いる<br>
  where を指定しないと全ての行が対象となる
- select, update, delete 文で使用可能
- where の後ろには条件式(true or false)を記述

#### さまざまな比較演算子

- =：左右の値が等しい
- <：左辺は右辺より小さい
- > ：左辺は右辺より大きい
- <=：左辺は右辺の値以下
- > =：左辺は右辺の値以上
- <>：左右の値は等しくない

---

#### NULL とは

- 未定義(データが格納されていないこと)を表す
- 数字のゼロや空白文字(スペース)とは異なる

#### NULL の判定

- 式 is null<br>
  NULL であることを判定

- 式 is not null<br>
  NULL でないことを判定

- NULL は=や<>で判定できない

##### 構文：select \* from テーブル名 where カラム名 is null

(カラム名)のデータが NULL である(テーブル名)のデータを全て取得

- select \* from 家計簿 where 出金額 is null

---

#### LIKE 演算子

- 文字列があるパターンに合致しているかを判定(パターンマッチング)

#### LIKE 演算子に使えるパターン文字

- %：任意の 0 文字以上の文字列
- \_：任意の 1 文字

##### 構文：select \* from テーブル名 where カラム名 like '%任意の文字%'

(任意の文字)を含む(カラム名)のデータがある(テーブル名)のデータ全てを取得<br>
※「任意の文字」の前のみに「%」を付ければ「～～任意の文字」<br>
※「任意の文字」の後ろのみに「%」を付ければ「任意の文字～～」

- select \* from 家計簿 where メモ like '%1 月%'
  メモカラムに 1 月の文字を含む家計簿テーブルのデータを全て取得

---

#### BETWEEN 演算子

- ある範囲内に値が収まっているかを判定

##### 構文：select \* from テーブル名 where カラム名 between 値 1 and 値 2

(カラム名)の値が(値 1)から(値 2)である(テーブル名)のデータを全て取得

- select \* from 家計簿 where 出金額 between 100 and 3000<br>
  出金額カラムの値が 100 以上 3000 以下の範囲にある家計簿テーブルの値を全て取得

---

#### IN / NOT IN 演算子

- IN 演算子は値がカッコ内に列挙した複数の値のどれかに合致すれば true
- NOT IN 演算子は値がカッコ内に列挙した複数の値のどれとも合致しなければ true
- = 演算子 や <> 演算子は値がひとつしか指定できない

##### 構文：select \* from テーブル名 where カラム名 in (値 1, 値 2, 値 3)

(カラム名)の値が(値 1), (値 2), (値 3)のどれかと合致する(テーブル名)のデータを全て取得

- select \* from 家計簿 where 費目 in ('食費', '交際費')<br>
  費目カラムのデータが食費か交際費のどちらかと合致する家計簿テーブルのデータを全て取得

##### 構文：select \* from テーブル名 where カラム名 not in (値 1, 値 2, 値 3)

(カラム名)の値が(値 1), (値 2), (値 3)のどれとも合致しない(テーブル名)のデータを全て取得

- select \* from 家計簿 where 費目 not in ('食費', '交際費')<br>
  費目カラムのデータが食費か交際費のどちらとも合致しない家計簿テーブルのデータを全て取得

---

#### ANY / ALL 演算子

- 複数の値と大小の比較をする
- 必ず直前に比較演算子を付ける
- ANY 演算子は値がカッコ内に列挙した複数の値と比較して、いずれかが true であれば true
- ALL 演算子は値がカッコ内に列挙した複数の値と比較して、すべて true であれば true

##### 構文：select \* from テーブル名 where カラム名 比較演算子 any (値 1, 値 2, 値 3)

(カラム名)の値が(値 1), (値 2), (値 3)と比較して、いずれかが true である(テーブル名)のデータを全て取得

- select \* from 家計簿 where 出金額 < any (1000, 2000, 3000)<br>
  出金額カラムの値が 1000, 2000, 3000 のいずれかより小さい家計簿テーブルのデータを全て取得

##### 構文：select \* from テーブル名 where カラム名 比較演算子 all (値 1, 値 2, 値 3)

(カラム名)の値が(値 1), (値 2), (値 3)と比較して、すべて true である(テーブル名)のデータを全て取得

- select \* from 家計簿 where 出金額 < all (1000, 2000, 3000)<br>
  出金額カラムの値が 1000, 2000, 3000 の全ての値より小さい家計簿テーブルのデータを全て取得

---

#### 論理演算子

- 代表的な論理演算子は AND 演算子と OR 演算子

#### AND 演算子

- 複数の条件式すべてが true の場合だけ true
- update 買い物リスト set 価格 = 6200 where 名称 ='マリオカート' and 販売店 = 'トイザらス'<br>
  名称がマリオカートで販売店がトイザらスの買い物リストテーブルの価格カラムのデータを 6200 に更新

#### OR 演算子

- 複数の条件式のいずれかが true の場合 true
- update 買い物リスト set 価格 = 6200 where 名称 ='マリオカート' or 販売店 = 'トイザらス'<br>
  名称がマリオカート、もしくは販売店がトイザらスの買い物リストテーブルの価格カラムのデータを 6200 に更新

#### NOT 演算子

- 右辺の条件式の結果は true が false に、false が true に逆転
- update 買い物リスト set 価格 = 6200 where not 名称 ='マリオカート'<br>
  名称がマリオカートではない買い物リストテーブルの価格カラムのデータを 6200 に更新

---

#### 論理演算子の優先度

- 複数の論理演算子が使用される場合は NOT 演算子　 ⇒ 　 AND 演算子　 ⇒ 　 OR 演算子の順に処理
- 条件式にカッコを付けることで評価の優先度を上げることができる

---

#### 主キーとその必要性

- 重複した行があると、そのうちのある行だけを区別、識別することはできない
- ほかの行と値が重複しない主キー(primary key)となるカラムを持つべき
- 社員番号などのように自然に主キーの役割を果たすカラムを自然キー(natural key)と呼ぶ
- 入出金 ID などのように管理目的のために追加されたカラムを人工キー(artificial key)や代替キー(surrogate key)と呼ぶ
- 氏名、住所、生年月日のように複数のカラムを組み合わせて主キーとして扱うものを複合主キー(compound key)と呼ぶ
