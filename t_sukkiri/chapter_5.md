# スッキリわかる SQL 入門 第 2 版

## 第 Ⅱ 部　 SQL を使いこなそう

### 第 5 章　式と関数

#### 選択列リストへのさまざまな指定

| select カラム名 + 数値 as 別名のカラム名 from テーブル名                |
| ----------------------------------------------------------------------- |
| (テーブル名)の(カラム名　※integer)に(数値　※任意の数字)を足して全て取得 |

- カラムのデータに 2000 が格納されており、数値に 100 を入力した場合は 2000+100 で 2100 が取得される

##### 例：select 出金額 + 100 as 百円増しの出金額 from 家計簿

| insert into テーブル名(カラム名) values (計算式) |
| ------------------------------------------------ |
| (テーブル名)の(カラム名)に(計算式)の結果を追加   |

- insert into テーブル名(カラム名) values(計算式の結果)と同じ結果

##### 例：insert into 家計簿(出金額) values (1000 + 105)

| update テーブル名 set カラム名 = 計算式                |
| ------------------------------------------------------ |
| (テーブル名)の(カラム名)のデータを(計算式)の結果に更新 |

##### 例：update 家計簿 set 出金額 = 出金額 + 100

#### CASE 演算子

| case 評価する列や式 when 値 1 then 値 1 の時に返す値 else 値 2 end                |
| --------------------------------------------------------------------------------- |
| (評価する列や式)が(値 1)の時、(値 1 の時に返す値)に変換し、それ以外は(値 2)に変換 |

- if 文の概念と同じ
- 最初の条件式から評価され、条件が一致すればそのデータの評価は完了

##### 例：select 費目, 出金額, case 費目 when '居住費' then '固定費' when '水道光熱費' then '固定費' else '変動費' end as 出費の分類 from 家計簿 where 出金額 > 0

##### 例：select 費目, 入金額, case when 入金額 < 5000 then 'お小遣い' when 入金額 <300000 then '給料' else '想定外の収入' end as 収入の分類 from 家計簿 where 入金額 > 0

#### さまざまな関数

関数は呼び出し時に指定した情報(引数)に対して、定められた処理を行い、結果(戻り値)に変換させる

| 関数名       | 説明                 |
| ------------ | -------------------- |
| LENGTH / LEN | 文字列の長さを調べる |

##### 例：select メモ, length(メモ) as メモの長さ from 家計簿

##### 例：select メモ, length(メモ) as メモの長さ from 家計簿 where length(メモ) <= 10

| 関数名 | 説明                       |
| ------ | -------------------------- |
| TRIM   | 文字列の左右から空白を除去 |
| LTRIM  | 文字列の左側の空白を除去   |
| RTRPM  | 文字列の右側の空白を除去   |

##### 例：select メモ, trim(メモ) as 空白除去したメモ from 家計簿

| 関数名  | 説明                           |
| ------- | ------------------------------ |
| REPLACE | 文字列の一部を別の文字列に置換 |

- replace(置換対象の文字列, 置換前の部分文字列, 置換後の部分文字列)

##### 例：update 家計簿 set メモ = replace(メモ, '購入', '買った')

| 関数名             | 説明                         |
| ------------------ | ---------------------------- |
| SUBSTRING / SUBSTR | 文字列の一部分だけを取り出す |

- substring(対象の文字列のあるカラム名, 抽出を開始する位置, 抽出する文字の数)

##### 例：select \* from 家計簿 where substring(費目, 1, 3) like '%費%'

| 関数名 | 説明         |
| ------ | ------------ |
| CONCAT | 文字列を連結 |

- concat(文字列 1, 文字列 2)

##### 例：select concat(費目, ':', メモ) from 家計簿

| 関数名 | 説明             |
| ------ | ---------------- |
| ROUND  | 指定桁で四捨五入 |

- round(カラム名, 有効とする桁数)

##### 例：select 出金額, round(出金額, -2) as 百円単位の出金額 from 家計簿

| 関数名 | 説明               |
| ------ | ------------------ |
| TRUNC  | 指定桁で切り捨てる |

- trunc(カラム名, 有効とする桁数)

| 関数名 | 説明                      |
| ------ | ------------------------- |
| POWER  | べき乗(2 乗や 3 乗)を計算 |

- power(カラム名, 何乗するかの数値)

| 関数名       | 説明             |
| ------------ | ---------------- |
| CURRENT_DATE | 現在の日付を取得 |
| CURRENT_TIME | 現在の時刻を取得 |

- current_date 　 ⇒ 　 YYYY-MM-DD
- current_time 　 ⇒ 　 HH:MM:SS

##### 例：insert into 家計簿 values(current_date, '食費', 'ドーナッツを買った', 0, 260)

| 関数名 | 説明           |
| ------ | -------------- |
| CAST   | データ型を変換 |

- cast(変換する値 as 変換する型)

| 関数名   | 説明                                 |
| -------- | ------------------------------------ |
| COALESCE | 最初に登場する NULL ではない値を返す |

- coalesce(カラム 1, カラム 2, カラム 3)
- coalesce(式 1, 式 2, 式 3)

##### 例：日付, 費目, coalesce(メモ, '(メモは NULL です)') as メモ, from 家計簿
