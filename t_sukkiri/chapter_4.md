# スッキリわかる SQL 入門 第 2 版

## 第 Ⅰ 部　 SQL を始めよう

### 第 4 章　検索結果の加工

#### DISTINCT キーワード(重複業を除外)

SELECT 文に付加すると、結果表の中で重複する行があれば、その重複を取り除く

##### 構文：select distinct カラム名 from テーブル名

(テーブル名)から(カラム名)のデータの重複するデータの重複を取り除き全て出力

- select distinct 入金額 from 家計簿<br>
  家計簿テーブルから入金額カラムの重複するデータの重複を取り除き全て出力

---

#### ORDER BY 句(結果を並び替える)

select 文の最後に記述すると、指定したカラムの値を基準として検索結果を並び替えて取得できる

- 並び順は ASC と DESC の 2 パターンあり、記述を省略すると ASC と同じ意味となる
- ASC：昇順　※1 　 ⇒ 　 2 　 ⇒ 　 3
- DESC：降順　※3 　 ⇒ 　 2 　 ⇒ 　 1

##### 構文：select カラム名 1, カラム名 2 from テーブル名 order by カラム名 n 並び順

(テーブル名)の(カラム名 1)と(カラム名 2)のデータを(カラム名 n)の(並び順)で並び替えて全て取得

- select \* from 家計簿 order by 出金額<br>
  家計簿テーブルのデータを出金額カラムの昇順に並び替えて全て取得
- select \* from 家計簿 order by 日付 desc<br>
  家計簿テーブルのデータを日付カラムの降順に並び替えて全て取得

##### 複数列の並び替え

最初に記述した並び替えの指定で、同じ値が複数行あれば、その次に記述した並び替えの指定が適用

- select \* from 家計簿 order by 入金額 desc, 出金額 desc<br>
  家計簿テーブルのデータを入金額の降順に並び替えて、同じ値に関しては出金額の降順に並び替えて全て取得

---

#### OFFSET - FETCH 句(先頭から数行だけ取得)

ORDER BY 句に続けて記述することで、並び替えた結果の一部の行のみ取得することができる

##### 構文：select カラム名 1, カラム名 2 from テーブル名 order by カラム名 n offset 先頭から除外する行数 rows fetch next 取得行数 rows only

(テーブル名)の(カラム名 1)と(カラム名 2)のデータを(カラム名 n)の(並び順)で並び替えて、(先頭から除外する行数)のデータを取り除き、(取得行数)分のみ取得

- select 費目, 出金額, from 家計簿 order by 出金額 desc offset 0 rows fetch next 3 rows only<br>
  家計簿テーブルから費目, 出金額カラムのデータを出金額カラムの降順に並び替え、出金額の高い順に 3 件を取得
- select 費目, 出金額 from 家計簿 order by 出金額 desc offset 2 rows fetch next 1 rows only<br>
  家計簿テーブルから費目, 出金額カラムのデータを出金額カラムの降順に並び替え、3 番目に高い出金額のみ取得

---

#### 集合演算子

構造がよく似た(カラムが同じ)複数のテーブルに 1 つの SQL 文で SELECT 文を実行することができる方法

---

#### UNION 演算子(和集合を求める)

最も代表的な集合演算子で、それぞれの結果を足し合わせたた結果(和集合)が返される

- 検索するカラムの数、データ型を一致させなければならない
- ORDER BY 句は最後の SELECT 文に記述しなければならない
- ORDEr BY 句で列番号以外による指定では、1 つ目の SELECT 文のカラムを指定しなければならない
- カラムの数が合わない場合は NULL を追加することで数を一致させることができる

##### 構文：select カラム名 from テーブル名 1 union select カラム名 from テーブル名 2<br>

(テーブル名 1)と(テーブル名 2)から(カラム名)のデータを重複行を 1 行にまとめて全て取得

##### 構文：select カラム名 from テーブル名 1 union all select カラム名 from テーブル名 2<br>

(テーブル名 1)と(テーブル名 2)から(カラム名)のデータを重複行を 1 行にまとめずに全て取得

- select 費目, 入金額, 出金額 from 家計簿 union select 費目, 入金額, 出金額 from 家計簿アーカイブ order by 2, 3, 1<br>
  家計簿テーブルと家計簿アーカイブテーブルから費目, 入金額, 出金額カラムのデータを入金額、出金額、費目の昇順に並び替え、重複行を 1 行にまとめて全て取得

---

#### EXCEPT / MINUS 演算子(差集合を求める)

ある SELECT 文の検索結果にそんざいする行から、別の SELECT 文の検索結果に存在する行を差し引いた集合

- Oracle DB では MINUS を用いる
- どの集合を基準にするかで検索結果が変わる

##### 構文：select カラム名 from テーブル名 1 except select カラム名 from テーブル名 2<br>

(テーブル名 1)を基準に(テーブル名 2)にも存在する(カラム名)のデータを取り除き、重複行を 1 行にまとめて全て取得

##### 構文：select カラム名 from テーブル名 1 except all select カラム名 from テーブル名 2<br>

(テーブル名 1)を基準に(テーブル名 2)にも存在する(カラム名)のデータを取り除き、重複行を 1 行にまとめずに全て取得

- select 費目 from 家計簿 except select 費目 from 家計簿アーカイブ<br>
  家計簿テーブルを基準に、家計簿アーカイブテーブルにも存在する費目カラムのデータを取り除き、重複業を 1 行にまとめて全て取得

---

#### INTERSECT 演算子(席集合を求める)

2 つの SELECT 文に共通する行を集めた集合

##### 構文：select カラム名 from テーブル名 1 intersect select カラム名 from テーブル名 2<br>

(テーブル名 1)と(テーブル名 2)に共通して存在する(カラム名)のデータを、重複行を 1 行にまとめて全て取得

##### 構文：select カラム名 from テーブル名 1 intersect all select カラム名 from テーブル名 2<br>

(テーブル名 1)と(テーブル名 2)に共通して存在する(カラム名)のデータを、重複行を 1 行にまとめずに全て取得

- select 費目 from 家計簿 intersect select 費目 from 家計簿アーカイブ<br>
  家計簿テーブルと家計簿アーカイブテーブルに共通して存在する費目カラムのデータを、重複行を 1 行にまとめて全て取得
